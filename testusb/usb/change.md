# PCAP04 配置寄存器说明文档

## 概述
PCAP04是一款电容数字转换器（CDC）芯片，通过64个配置寄存器（Reg 0 ~ Reg 63）进行功能配置。

在实际使用时，既可以通过写固件时将寄存器配置写入，也可以通过单独写寄存器来实现对PCAP04的配置，这样可以在使用过程中修改配置。

## 配置数组

### 标准配置（PCAP04_Config）
```c
unsigned char PCAP04_Config[] = {
 0x1D, 0x00, 0x58, 0x10,  // Reg 0-3
 0x10, 0x00, 0x3F, 0x20,  // Reg 4-7
 0x00, 0xD0, 0x07, 0x00,  // Reg 8-11
 0x00, 0x08, 0xFF, 0x03,  // Reg 12-15
 0x00, 0x24, 0x00, 0x00,  // Reg 16-19
 0x00, 0x01, 0x50, 0x30,  // Reg 20-23
 0x73, 0x04, 0x50, 0x08,  // Reg 24-27
 0x5A, 0x00, 0x82, 0x08,  // Reg 28-31
 0x08, 0x00, 0x47, 0x40,  // Reg 32-35
 0x00, 0x00, 0x00, 0x71,  // Reg 36-39
 0x00, 0x00, 0x08, 0x00,  // Reg 40-43
 0x00, 0x00, 0x00, 0x01,  // Reg 44-47
 0x00, 0x00, 0x00, 0x00   // Reg 48-51
};
```

---

## 寄存器详细说明



### CDC配置相关（0-19）

### 寄存器 0 (0x1D) - IIC地址与低频时钟配置

- **位[7:6] I2C_A**: I²C设备地址补码配置
  - 0-3: I²C地址补码（用于设置I²C从机地址）
- **位[5:2] OLF_FTUNE**: 低频时钟微调
  - 0: 最小值
  - 7: 典型值（推荐）
  - 15: 最大值
- **位[1:0] OLF_CTUNE**: 低频时钟粗调
  - 0 (0b00): 10 kHz
  - 1 (0b01): 50 kHz
  - 2 (0b10): 100 kHz
  - 3 (0b11): 200 kHz（推荐）

**当前配置**: 0x1D = 0b00011101
- I2C_A = 0 (位[7:6])

- OLF_FTUNE = 7 (位[5:2]) - 典型值

- OLF_CTUNE = 3 (位[1:0]) - 200 kHz

- | OLF_CTUNE | OLF_FTUNE | 频率    |
  | --------- | --------- | ------- |
  | 0(10khz)  | 1         | 5 kHz   |
  |           | 7         | 10 kHz  |
  | 1(50khz)  | 0         | 28 kHz  |
  |           | 3         | 48 kHz  |
  | 2(100khz) | 4         | 100 kHz |
  | 3(200khz) | 5         | 200 kHz |

- 

  通过同时设置OLF_CTUNE和OLF_FTUNE即可设定系统的时钟频率，这个频率的大小对设置电容的充放电周期有影响，如果电容很大，充电时间长，那么这里的频率设置和后面的充电周期数设置就需要匹配，否则电容可能都还没有完全充电或放电，从而影响测量结果

**常用配置选项**:
| 十六进制值 | 二进制值 | OLF频率 | 说明 |
|-----------|----------|---------|------|
| 0x1C | 0b00011100 | 10 kHz | I2C_A=0, OLF_FTUNE=7, OLF_CTUNE=0 |
| 0x1D | 0b00011101 | 50 kHz | I2C_A=0, OLF_FTUNE=7, OLF_CTUNE=1 |
| 0x1E | 0b00011110 | 100 kHz | I2C_A=0, OLF_FTUNE=7, OLF_CTUNE=2 |
| 0x1F | 0b00011111 | 200 kHz | I2C_A=0, OLF_FTUNE=7, OLF_CTUNE=3（推荐） |
| 0x5F | 0b01011111 | 200 kHz | I2C_A=1, OLF_FTUNE=7, OLF_CTUNE=3 |
| 0x9F | 0b10011111 | 200 kHz | I2C_A=2, OLF_FTUNE=7, OLF_CTUNE=3 |
| 0xDF | 0b11011111 | 200 kHz | I2C_A=3, OLF_FTUNE=7, OLF_CTUNE=3 |

---

### 寄存器 1 (0x00) - 外部晶振时钟OX配置
- **位[7] OX_DIS**: 禁用OX时钟
  - 0: 启用（默认）
  - 1: 禁用
- **位[5] OX_DIV4**: OX时钟4分频
  - 0: 不分频，f_ox = 2MHz
  - 1: 4分频，f_ox = 0.5MHz
- **位[4] OX_AUTOSTOP_DIS**: ams内部位（默认: 0）
- **位[3] OX_STOP**: ams内部位（默认: 0）
- **位[2:0] OX_RUN**: 控制OX发生器的持续性或延迟
  - 0: 发生器关闭
  - 1: OX永久运行
  - 2: OX延迟 = 31 / fOLF
  - 3: OX延迟 = 2 / fOLF
  - 6: OX延迟 = 1 / fOLF

**说明**: 延迟意味着在测量开始前振荡器的稳定时间。

---

### 寄存器 2 (0x58) - 端口放电电阻配置
- **位[7:6] RDCHG_INT_SEL1**: PC4~PC5的片上放电电阻选择
  - 0: 180 kΩ
  - 1: 90 kΩ
  - 2: 30 kΩ（默认）
  - 3: 10 kΩ
- **位[5:4] RDCHG_INT_SEL0**: PC0~PC3和内部端口PC6的片上放电电阻选择
  - 0: 180 kΩ
  - 1: 90 kΩ
  - 2: 30 kΩ（默认）
  - 3: 10 kΩ
- **位[3] RDCHG_INT_EN**: 内部放电电阻使能
  - 0: 关闭
  - 1: 内部开启（默认）
- **位[2]**: 未使用
- **位[1] RDCHG_EXT_EN**: 外部放电电阻使能
  - 0: 关闭（默认）
  - 1: 外部开启（在PCAUX上切换外部放电电阻，在放电阶段高阻，在预充和满充阶段为高阻）
- **位[0]**: 未使用

**注意**: 使用外部放电电阻时，需要设置AUX_PD_DIS（寄存器3，位6）= 1

**当前配置**: 0x58 = 0b01011000
- RDCHG_INT_SEL1 = 2 (30 kΩ)

- RDCHG_INT_SEL0 = 2 (30 kΩ)

- RDCHG_INT_EN = 1 (启用)

  其中，bit1为外部放电电阻开关位，bit3为内部放电电阻开关位，bit4~7为内部放电电阻阻值选择位。一般使用内部放电电阻即可，并且内部放电电阻有四个挡位可以选择，对于小电容可以将放电电阻阻值设置的大一点，这样放电时间会长一些，相反则可以选择小一点的放电电阻，从而缩短放电时间，具体可以根据测量放电波形来调节，保证放电波形完整，但时间不要拖得过长。是否使用外部放电电阻可以根据项目需求自行调整，而使用外部放电电阻那么外部电路也需要做相应的配置。

**常用配置选项**:
| 十六进制值 | 二进制值 | PC4~5电阻 | PC0~3电阻 | 内部使能 | 说明 |
|-----------|----------|-----------|-----------|----------|------|
| 0x08 | 0b00001000 | 180 kΩ | 180 kΩ | 启用 | 全部高阻 |
| 0x18 | 0b00011000 | 180 kΩ | 30 kΩ | 启用 | PC0~3中阻 |
| 0x28 | 0b00101000 | 30 kΩ | 180 kΩ | 启用 | PC4~5中阻 |
| 0x38 | 0b00111000 | 30 kΩ | 30 kΩ | 启用 | 全部中阻 |
| 0x58 | 0b01011000 | 30 kΩ | 30 kΩ | 启用 | 当前配置（推荐） |
| 0x78 | 0b01111000 | 10 kΩ | 10 kΩ | 启用 | 全部低阻 |
| 0xF8 | 0b11111000 | 10 kΩ | 10 kΩ | 启用 | 全部最低阻 |

---

### 寄存器 3 (0x10) - 端口充放电电阻配置
- **位[6] AUX_PD_DIS**: 禁用PCAUX下拉电阻
  - 0: 下拉激活
  - 1: 下拉禁用
- **位[5] AUX_CINT**: 仅在内部参考转换期间激活辅助端口PCAUX
  - 0: 正常（默认）
  - 1: 在内部c参考转换期间激活辅助端口
- **位[4:3] RDCHG_OPEN**: ams内部位（推荐值: 2）
- **位[2] RDCHG_PERM_EN**: 保持芯片内部放电电阻永久连接
  - 0: 关闭（默认）
  - 1: 开启
- **位[1] RDCHG_EXT_PERM**: 永久激活辅助端口PCAUX
  - 0: 关闭（默认）
  - 1: 开启
  - **用途**: a) 永久放电，或 b) 为每个充放电周期添加偏移电容
  - **注意**: 需要设置AUX_PD_DIS = 1
- **位[0] RCHG_SEL**: 选择充电电阻
  - 0: 180 kΩ
  - 1: 10 kΩ（默认）

**当前配置**: 0x10 = 0b00010000
- RCHG_SEL = 0 (180 kΩ)

---

### 寄存器 4 (0x10) - 端口电容连接方式
- **位[7] C_REF_INT**: 使用片上参考电容
  - 0: 外部参考（PC0/GND或PC0/PC1）
  - 1: 内部参考（在CDC特殊端口PC6使用片上参考电容）
- **位[6]**: 未使用
- **位[5] C_COMP_EXT**: 激活外部寄生电容补偿机制
  - 0: 空闲
  - 1: 激活
  - **注意**: 当C_FLOATING==0时必须避免使用
- **位[4] C_COMP_INT**: 激活片上寄生电容补偿机制和增益补偿
  - 0: 空闲
  - 1: 激活
- **位[3:2]**: 未使用
- **位[1] C_DIFFERENTIAL**: 选择单端或差分传感器
  - 0: 普通（单端）
  - 1: 差分
- **位[0] C_FLOATING**: 选择接地或浮动传感器
  - 0: 接地
  - 1: 浮动

**当前配置**: 0x10 = 0b00010000
- C_REF_INT = 0 (外部参考)

- C_COMP_EXT = 0 (禁用)

- C_COMP_INT = 0 (禁用)

- C_DIFFERENTIAL = 0 (单端)

- C_FLOATING = 0 (接地)

  bit7用于选择使用外部参考电容或内部参考电容，内部参考电容值为1~31pF，如果我们需要测量的电容大于500pF时，务必使用外部参考电容。bit5为外部寄生电容补偿位，建议开启，这样芯片内部将会通过内部电路独立放电来测试寄生电容对测量值进行修正；bit4为内部寄生电容补偿位；bit1和bit0用于是独立测量还是差分测量。

**常用配置选项**:
| 十六进制值 | 二进制值 | 参考类型 | 测量模式 | 接地方式 | 说明 |
|-----------|----------|----------|----------|----------|------|
| 0x00 | 0b00000000 | 外部 | 单端 | 接地 | 外部参考，单端接地 |
| 0x01 | 0b00000001 | 外部 | 单端 | 浮动 | 外部参考，单端浮动 |
| 0x02 | 0b00000010 | 外部 | 差分 | 接地 | 外部参考，差分接地 |
| 0x03 | 0b00000011 | 外部 | 差分 | 浮动 | 外部参考，差分浮动 |
| 0x10 | 0b00010000 | 外部 | 单端 | 接地 | 当前配置（推荐） |
| 0x80 | 0b10000000 | 内部 | 单端 | 接地 | 内部参考，单端接地 |
| 0x90 | 0b10010000 | 内部 | 单端 | 接地 | 内部参考+补偿，单端接地 |

---

### 寄存器 5 (0x00) - CDC时钟与端口模式配置
- **位[7] CY_PRE_MR1_SHORT**: 减少内部时钟路径之间的延迟
  - 0: 正常（推荐）
  - 1: 减少
- **位[6]**: 未使用
- **位[5] C_PORT_PAT**: 端口测量顺序交替
  - 0: 正常
  - 1: 端口顺序交替（每次序列后反转测量端口的顺序）
  - **注意**: 如果激活C_PORT_PAT，则C_AVRG + C_FAKE应为偶数
- **位[4]**: 未使用
- **位[3] CY_HFCLK_SEL**: CDC时钟源选择
  - 0: OLF（低频时钟）
  - 1: OHF（高频时钟）
- **位[2] CY_DIV4_DIS**: 四倍时钟周期（仅在与CY_HFCLK_SEL == 1组合时）
  - 0: 关闭
  - 1: 开启
- **位[1] CY_PRE_LONG**: 在内部时钟路径之间添加安全延迟
  - 0: 关闭（推荐）
  - 1: 开启
- **位[0] C_DC_BALANCE**: 仅用于差分浮动模式
  - 0: 关闭（"single HiZ"）
  - 1: 直流自由（"both HiZ"）
  - **说明**: 改变端口控制以消除电容感应的直流（其他模式是直流自由的）

**注意**: CY_HFCLK_SEL和CY_DIV4_DIS在评估软件中组合为'Cycle Clock Select'

**当前配置**: 0x00 = 0b00000000
- 所有位为默认值

---

### 寄存器 6 (0x3F) - 测量端口使能配置
- **位[5:0] C_PORT_EN**: 位使能CDC端口（PC0到PC5）
  - 位0: PC0
  - 位1: PC1
  - 位2: PC2
  - 位3: PC3
  - 位4: PC4
  - 位5: PC5
  - **注意**: 仅支持PC0~PC5（6个端口），不支持PC6和PC7

| 位值 | 端口配置 | 说明 |
|------|----------|------|
| 0x00 | 全部关闭 | CDC将不工作 |
| 0x01 | PC0 | 仅PC0激活 |
| 0x02 | PC1 | 仅PC1激活 |
| 0x04 | PC2 | 仅PC2激活 |
| 0x08 | PC3 | 仅PC3激活 |
| 0x10 | PC4 | 仅PC4激活 |
| 0x20 | PC5 | 仅PC5激活 |
| 0x0F | PC0~PC3 | 4通道 |
| 0x3F | PC0~PC5 | 6通道（全部端口） |

**多端口组合示例**:
- PC0 + PC1 = 0x01 + 0x02 = 0x03
- PC0 + PC1 + PC3 = 0x01 + 0x02 + 0x08 = 0x0B

**当前配置**: 0x3F = 0b00111111
- 所有端口PC0~PC5已启用

  寄存器6为电容采集通道开关配置使用，PCAP04最大支持六路电容采集，如果需要开启相应的通道，只需要将对应位置1即可，例如0x0F则表示通道0~3开启。

**常用配置选项**:
| 十六进制值 | 二进制值 | 启用端口 | 通道数 | 说明 |
|-----------|----------|----------|--------|------|
| 0x00 | 0b00000000 | 无 | 0 | CDC不工作 |
| 0x01 | 0b00000001 | PC0 | 1 | 仅PC0 |
| 0x02 | 0b00000010 | PC1 | 1 | 仅PC1 |
| 0x03 | 0b00000011 | PC0~1 | 2 | 双通道 |
| 0x04 | 0b00000100 | PC2 | 1 | 仅PC2 |
| 0x07 | 0b00000111 | PC0~2 | 3 | 三通道 |
| 0x0F | 0b00001111 | PC0~3 | 4 | 四通道 |
| 0x1F | 0b00011111 | PC0~4 | 5 | 五通道 |
| 0x3F | 0b00111111 | PC0~5 | 6 | 全部端口（当前配置） |

---

### 寄存器 7-8 (0x20, 0x00) - 采样平均配置
- **位[12:0] C_AVRG**: 设置CDC测量的平均采样数（从寄存器7开始的13位）
  - 0, 1: 采样大小 = 1（不平均）
  - 2: 采样大小 = 2
  - 3: 采样大小 = 3
  - ...
  - 8191: 最大采样大小

**当前配置**: 0x0020 = 32（十进制）
- 32次采样平均

**说明**: 增加平均次数可以提高测量精度，但会降低测量速度。

寄存器7-8用于配置计算平均值时的采样次数，最大可以到8191次，也就是电容值是采样8191次之后的平均值，这个值越大，采样值越平稳，但对应的采样时间也会越长，这个根据实际需要配置。

---

### 寄存器 9-11 (0xD0, 0x07, 0x00) - 转换时间配置
- **位[22:0] CONV_TIME**: 转换触发周期或序列周期（23位，从寄存器9开始）
  - **公式**: `Tconv/seq = 2 × CONV_TIME / fOLF`
  - Tconv必须小于或等于测量周期

**当前配置**: 0x0007D0 = 2000（十进制）
- 如果OLF = 200 kHz，则 Tconv = 2 × 2000 / 200000 = 20 ms

---

### 寄存器 12-13 (0x00, 0x08) - 放电时间配置
- **位[9:0] DISCHARGE_TIME**: 设置CDC放电时间（10位，寄存器12的位[7:0]和寄存器13的位[1:0]）
  - **OLF模式**: `Tdischarge = (DISCHARGE_TIME + 1) × Tcycleclock`
  - **OHF模式**: `Tdischarge = DISCHARGE_TIME × Tcycleclock`
  - 1023: 关闭

**当前配置**: 0x000 = 0
- Tdischarge = 1 × Tcycleclock

---

### 寄存器 13 (0x08) - GPIO触发与CDC启动配置
- **位[7:6] C_STARTONPIN**: 选择允许触发CDC启动的GPIO端口
  - 0: PG0
  - 1: PG1
  - 2: PG2
  - 3: PG3
- **位[4:2] C_TRIG_SEL**: CDC触发模式选择
  - 0: 连续模式
  - 1: 读取触发
  - 2: 定时器触发
  - 3: 定时器触发（拉伸模式）
  - 4: 未定义
  - 5: 引脚触发（硬件触发）
  - 6: 操作码触发
  - 7: continuous_exp（不推荐）
- **位[1:0] DISCHARGE_TIME**: 放电时间配置的低2位（参见寄存器12）

**当前配置**: 0x08 = 0b00001000
- C_STARTONPIN = 0 (PG0)

- C_TRIG_SEL = 2 (定时器触发)

  PCAP04每次测量包括CDC测量、RDC测量和DSP转换三个过程，当然我们如果不使用CDC或RDC时可以将其关闭，这样可以节省转换时间，一次测量并转换完成后，系统会产生一个下降沿信号INTN,这时表示转换完成并可以读取数据了，那么下一次何时转换取决于C_TRIG_SEL的配置，具体差异下面逐一说明：

  （1）连续模式：一次转换结束后马上进行下一次转换，这种方式不推荐使用，因为可能你在转换的同时也在读取数据，增加测量噪声。

  （2）读取触发：转换完成后，系统将不会主动转换，而是会等待用户读取结果寄存器后进行下次转换，读结果寄存器一般和SPI或IIC的结束信号关联，这样来判断数据是否读取完成，然后自动的进行下一次转换。

  （3）时间触发：时间触发转换取决用用户设定的转换时间，例如设定转换时间为5ms，那么每到5ms系统就会做一次转换，所以必须保证设定的转换时间大于CDC+RDC+DSP三个阶段的时间和，否则可能出错。

  （4）操作码或外部触发：操作码或外部GPIO触发则比较直接，系统接收到转换指令后才开始转换，这个比较合适和软件配合使用。

**常用配置选项**:
| 十六进制值 | 二进制值 | 触发模式 | 启动引脚 | 说明 |
|-----------|----------|----------|----------|------|
| 0x00 | 0b00000000 | 连续模式 | PG0 | 连续测量 |
| 0x04 | 0b00000100 | 读取触发 | PG0 | 读取时触发 |
| 0x08 | 0b00001000 | 定时器触发 | PG0 | 当前配置（推荐） |
| 0x0C | 0b00001100 | 定时器拉伸 | PG0 | 定时器拉伸模式 |
| 0x14 | 0b00010100 | 引脚触发 | PG0 | 硬件引脚触发 |
| 0x18 | 0b00011000 | 操作码触发 | PG0 | 操作码触发 |
| 0x48 | 0b01001000 | 定时器触发 | PG1 | 使用PG1 |
| 0x88 | 0b10001000 | 定时器触发 | PG2 | 使用PG2 |
| 0xC8 | 0b11001000 | 定时器触发 | PG3 | 使用PG3 |

---

### 寄存器 14-15 (0xFF, 0x03) - 预充电时间配置
- **位[9:0] PRECHARGE_TIME**: 设置CDC预充电时间（10位，寄存器14的位[7:0]和寄存器15的位[1:0]）
  - **OLF模式**: `Tprecharge = (PRECHARGE_TIME + 1) × Tcycleclock`
  - **OHF模式 & FULLCHARGE_TIME = 1023**: `Tprecharge = (PRECHARGE_TIME + 2) × Tcycleclock`
  - **OLF模式 & FULLCHARGE_TIME != 0x3FF**: `Tprecharge = (PRECHARGE_TIME + 1) × Tcycleclock`
  - 1023: 关闭

**当前配置**: 0x3FF = 1023
- PRECHARGE_TIME = 1023 (预充电时间关闭)

- **注意**: 寄存器14 = 0xFF (255), 寄存器15的低2位 = 0b11 (3), 组合为10位值 = 1023

  寄存器14配置电容的预充电时间，其实我们可以选择是否需要预充电，按官方手册的说法，预充就是先快速将电容充电到某一个电压水平，然后再改变充电速度，缓慢充电到峰值水平，这样可以减小机械应力，同时还可以用来检测电容是否存在短路（如果短路了，充电电压将无法上升到目标电压），这个可以根据实际需要来配置。

---

### 寄存器 15 (0x03) - 假测量配置
- **位[5:2] C_FAKE**: CDC的"假"或"预热"测量数量
  - 0: 无假测量
  - 1: 1次假测量
  - ...
  - 15: 15次假测量
  - **说明**: 在"真实"测量之前执行，假测量值不计入结果
- **位[1:0] PRECHARGE_TIME**: 预充电时间配置的低2位（参见寄存器14）

**当前配置**: 0x03 = 0b00000011
- C_FAKE = 0 (位[5:2] = 0b0000，无假测量)

- PRECHARGE_TIME的低2位 = 3 (位[1:0] = 0b11)

  寄存器15用于配置伪测量次数，也就是再正式测量之前先做几次伪测量，但这几次的测量值并不会被用于真实测量值，这个根据需要配置，一般配置2-3个就可以了，不配置影响也不大，可以将寄存器7-8中的采样次数稍微增大一些，也可以减小数据的波动或测量未稳定时的干扰。

---

### 寄存器 16-17 (0x00, 0x24) - 满充电时间配置
- **位[9:0] FULLCHARGE_TIME**: 设置CDC满充电时间（10位，寄存器16的位[7:0]和寄存器17的位[1:0]）
  - **OLF模式**: `Tfullcharge = (FULLCHARGE_TIME + 1) × Tcycleclock`
  - **OHF模式**: `Tfullcharge = (FULLCHARGE_TIME + 2) × Tcycleclock`

**当前配置**: 0x000 = 0
- Tfullcharge = 1 × Tcycleclock (OLF模式)

  寄存器16用于配置完全充电时的周期数，也就是充满电后持续的时间，这个根据需要设置即可。

---

### 寄存器 17 (0x24) - 内部参考电容大小
- **位[6:2] C_REF_SEL**: 设置片上参考电容（5位）
  - 0: 最小值
  - 1: 约1 pF
  - ...
  - 31: 最大值（约31 pF）
  - **注意**: 步长从0.3 pF到1.5 pF不等
- **位[1:0] FULLCHARGE_TIME**: 满充电时间配置的低2位（参见寄存器16）

**当前配置**: 0x24 = 0b00100100
- C_REF_SEL = 4 (位[6:2] = 0b00100 = 4)
- FULLCHARGE_TIME的低2位 = 0 (位[1:0] = 0b00)
- **注意**: C_REF_SEL = 4，对应约4-5 pF（步长从0.3 pF到1.5 pF不等）

---

### 寄存器 18 (0x00) - 保护驱动配置
- **位[7] C_G_OP_RUN**: 保护：运算放大器模式
  - 0: 永久
  - 1: 脉冲（在转换之间将OP设置为睡眠模式）
- **位[6] C_G_OP_EXT**: 保护：激活外部运算放大器
  - 0: 内部OP
  - 1: 外部OP，PG3作为C_G_MUX_SEL
- **位[5:0] C_G_EN**: 保护使能，每位对应一个端口
  - 位0: 激活端口PC0
  - 位1: 激活端口PC1
  - 位2: 激活端口PC2
  - 位3: 激活端口PC3
  - 位4: 激活端口PC4
  - 位5: 激活端口PC5

**当前配置**: 0x00 = 0b00000000
- 保护功能未启用

---

### 寄存器 19 (0x00) - 保护运算放大器配置
- **位[7:6] C_G_OP_VU**: 保护：运算放大器增益（从感测端口到保护）
  - 0: × 1.00
  - 1: × 1.01
  - 2: × 1.02
  - 3: × 1.03
- **位[5:4] C_G_OP_ATTN**: 保护：运算放大器衰减
  - 0: 0.5 aF
  - 1: 1.0 aF
  - 2: 1.5 aF
  - 3: 2.0 aF
- **位[3:0] C_G_TIME**: 保护：在预充电期间将保护端口从"直接连接"切换到OP的时间
  - t = C_G_TIME × 500 ns

**当前配置**: 0x00 = 0b00000000
- 所有位为默认值

---

### RDC配置相关（20-39）

### 寄存器 20 (0x00) - RDC时间配置

- **位[7] R_CY**: RDC测定的循环时间（取决于OLF频率）

| OLF频率 | R_CY=0 | R_CY=1 |
|---------|--------|--------|
| 10 kHz | 100 μs | 200 μs |
| 50 kHz | 20 μs | 40 μs |
| 100 kHz | 10 μs | 20 μs |
| 200 kHz | 20 μs | 40 μs |

- **位[2:0] C_G_OP_TR**: 保护运算放大器电流调整
  - 0-7: 推荐值

**当前配置**: 0x00 = 0b00000000
- R_CY = 0

---

### 寄存器 21-22 (0x01, 0x50) - RDC预分频配置
- **位[9:0] R_TRIG_PREDIV**: 预分频器（10位，寄存器21的位[7:0]和寄存器22的位[1:0]）
  - 0, 1: 每次信号触发
  - 2: 每2次信号触发
  - 3: 每3次信号触发
  - ...
  - 1023: 最大因子
  - **说明**: 允许温度测量比电容测量慢。这是CDC与RDC测量速率之间的因子。如果OLF用作触发源，也用作OLF时钟分频器。

**当前配置**: 0x001 = 1
- 每次CDC测量后触发

---

### 寄存器 22 (0x50) - RDC触发选择
- **位[6:4] R_TRIG_SEL**: RDC触发源选择
  - 0: 关闭
  - 1: 定时器触发
  - 3: 引脚触发
  - 5: CDC异步（推荐）
  - 6: CDC同步
  - **说明**: 5和6由CDC转换结束触发
- **位[3:2] R_AVRG**: RDC测定的平均值配置
  - 0: 不平均
  - 1: 4次平均
  - 2: 8次平均
  - 3: 16次平均
- **位[1:0] R_TRIG_PREDIV**: 预分频器配置的低2位（参见寄存器21）

**当前配置**: 0x50 = 0b01010000
- R_TRIG_SEL = 5 (CDC异步，推荐)
- R_AVRG = 0 (不平均)

**常用配置选项**:
| 十六进制值 | 二进制值 | 触发源 | 平均次数 | 说明 |
|-----------|----------|--------|----------|------|
| 0x00 | 0b00000000 | 关闭 | 不平均 | RDC禁用 |
| 0x10 | 0b00010000 | 定时器 | 不平均 | 定时器触发 |
| 0x30 | 0b00110000 | 引脚触发 | 不平均 | 硬件引脚触发 |
| 0x50 | 0b01010000 | CDC异步 | 不平均 | 当前配置（推荐） |
| 0x54 | 0b01010100 | CDC异步 | 4次平均 | CDC异步+4次平均 |
| 0x58 | 0b01011000 | CDC异步 | 8次平均 | CDC异步+8次平均 |
| 0x5C | 0b01011100 | CDC异步 | 16次平均 | CDC异步+16次平均 |
| 0x60 | 0b01100000 | CDC同步 | 不平均 | CDC同步触发 |

---

### 寄存器 23 (0x30) - RDC端口与参考配置
- **位[7:6] R_PORT_EN**: RDC部分的端口激活
  - 'bx0: 禁用
  - 'bx1: 激活端口PTOREF
  - 'b0x: 禁用
  - 'b1x: 激活端口PT1
- **位[5] R_PORT_EN_IMES**: 内部铝温度传感器的端口激活
  - 0: 禁用
  - 1: 启用
- **位[4] R_PORT_EN_IREF**: 内部参考电阻的端口激活
  - 0: 禁用
  - 1: 启用
- **位[3]**: 未使用
- **位[2] R_FAKE**: RDC的"假"或"预热"测量数量
  - 0: 每次平均有2次假测量周期
  - 1: 每次平均有8次假测量周期
- **位[1:0] R_STARTONPIN**: 选择允许触发RDC启动的GPIO端口
  - 0: PG0
  - 1: PG1
  - 2: PG2
  - 3: PG3

**当前配置**: 0x30 = 0b00110000
- R_PORT_EN = 3 (激活PT1和PTOREF)
- R_PORT_EN_IMES = 0 (禁用)
- R_PORT_EN_IREF = 0 (禁用)
- R_FAKE = 0 (2次假测量)

---

### 寄存器 24-26 (0x73, 0x04, 0x50) - TDC配置
这些寄存器为ams内部固定配置（Time-to-Digital Converter），必须按照数据手册设置。

- **寄存器24 (0x73)**:
  - 位[7:6]: 未使用
  - 位[5:4] TDC_CHAN_EN: 必须为3
  - 位[3] TDC_ALUPERMOPEN: 必须为0
  - 位[2] TDC_NOISE_DIS: 必须为0
  - 位[1:0] TDC_MUPU_SPEED: 必须为3

- **寄存器25 (0x04)**:
  - 位[7:2] TDC_MUPU_NO: 必须为1
  - 位[1:0]: 未使用

- **寄存器26 (0x50)**:
  - 位[7:2] TDC_QHA_SEL: 必须为20
  - 位[1] TDC_NOISE_CY_DIS: 必须为1
  - 位[0]: 未使用

**当前配置**: 按照标准配置

---

### 寄存器 27 (0x08) - DSP配置
- **位[7:6] DSP_MOFLO_EN**: 在GPIO脉冲线中启用单稳态（防抖滤波器）
  - 0: 关闭
  - 3: 开启
- **位[5:4]**: 未使用
- **位[3:2] DSP_SPEED**: DSP速度
  - 0: 最快
  - 1: 快
  - 2: 慢（推荐）
  - 3: 最慢
- **位[1] PG1xPG3**: 切换PG1/PG3到/从DSP的接线
  - 0: 脉冲输出在PG3
  - 1: 脉冲输出在PG1
- **位[0] PG0xPG2**: 切换PG0/PG2到/从DSP的接线
  - 0: 脉冲输出在PG2
  - 1: 脉冲输出在PG0

**当前配置**: 0x08 = 0b00001000
- DSP_MOFLO_EN = 0 (关闭)
- DSP_SPEED = 2 (慢，推荐)
- PG1xPG3 = 0 (PG3)
- PG0xPG2 = 0 (PG2)

---

### 寄存器 28 (0x5A) - 看门狗配置
- **位[7:0] WD_DIS**: 看门狗禁用
  - 0x5A: 看门狗禁用（关闭）
  - 0x00（推荐）/ 其他值: 看门狗启用
  - **说明**: 要禁用看门狗，必须将0x5A写入该寄存器。看门狗周期在9s到15s之间。

**当前配置**: 0x5A = 看门狗已禁用

---

### 寄存器 29 (0x00) - DSP触发配置
- **位[7:4] DSP_STARTONPIN**: 启动DSP的引脚掩码（位方式PG0到PG3）
  - 此掩码允许将一个或多个GPIO引脚分配给启动DSP
- **位[3:0] DSP_FF_IN**: 触发器激活的引脚掩码（位方式DSP_IN_0到DSP_IN_3）

**当前配置**: 0x00 = 0b00000000
- 所有位为默认值

---

### 寄存器 30 (0x82) - 中断配置
- **位[7] PG5_INTN_EN**: 将INTN信号路由到PG5
  - 0: PG5正常工作
  - 1: PG5 <== INTN
- **位[6] PG4_INTN_EN**: 将INTN信号路由到PG4
  - 0: PG4正常工作
  - 1: PG4 <== INTN
- **位[5:3]**: 未使用
- **位[2:0] DSP_START_EN**: DSP触发器启用
  - 'bxxx1: 由CDC结束触发
  - 'bxx1x: 由RDC结束触发（推荐）
  - 'bx1xx: 由定时器触发

**当前配置**: 0x82 = 0b10000010
- PG5_INTN_EN = 1 (PG5 <== INTN)
- DSP_START_EN = 2 (由RDC结束触发，推荐)

---

### 寄存器 31 (0x08) - 脉冲接口0配置
- **位[7] PI1_TOGGLE_EN**: 在脉冲接口1输出激活切换触发器
  - 0: 正常工作
  - 1: 切换触发器激活（特别适用于PDM以创建1:1占空比）
- **位[6] PIO_TOGGLE_EN**: 在脉冲接口0输出激活切换触发器
  - 0: 正常工作
  - 1: 切换触发器激活（特别适用于PDM以创建1:1占空比）
- **位[5:4] PIO_RES**: 脉冲编码接口0的分辨率
  - 0: 10位
  - 1: 12位
  - 2: 14位
  - 3: 16位
- **位[3] PIO_PDM_SEL**: 脉冲接口0 PWM / PDM开关
  - 0: PWM
  - 1: PDM
- **位[2:0] PIO_CLK_SEL**: 脉冲接口0时钟选择
  - 0: 关闭
  - 1: OLF / 1
  - 2: OLF / 2
  - 3: OLF / 4
  - 4: OX / 1
  - 5: OX / 2
  - 6: OX / 4
  - 7: 未定义

**当前配置**: 0x08 = 0b00001000
- PI1_TOGGLE_EN = 0 (正常工作)
- PIO_TOGGLE_EN = 0 (正常工作)
- PIO_RES = 0 (10位)
- PIO_PDM_SEL = 0 (PWM)
- PIO_CLK_SEL = 1 (OLF / 1)

---

### 寄存器 32 (0x08) - 脉冲接口1配置
- **位[7:6]**: 未使用
- **位[5:4] PI1_RES**: 脉冲接口1的分辨率
  - 0: 10位
  - 1: 12位
  - 2: 14位
  - 3: 16位
- **位[3] PI1_PDM_SEL**: 脉冲接口1 PWM / PDM开关
  - 0: PWM
  - 1: PDM
- **位[2:0] PI1_CLK_SEL**: 脉冲接口1时钟选择
  - 0: 关闭
  - 1: OLF / 1
  - 2: OLF / 2
  - 3: OLF / 4
  - 4: OX / 1
  - 5: OX / 2
  - 6: OX / 4
  - 7: 未定义

**当前配置**: 0x08 = 0b00001000
- PI1_RES = 0 (10位)
- PI1_PDM_SEL = 0 (PWM)
- PI1_CLK_SEL = 0 (关闭)

**注意**: 根据配置数组，寄存器32 = 0x08，但实际应用中可能需要根据具体需求调整脉冲接口1的配置。

---

### 寄存器 33 (0x00) - GPIO配置
- **位[7:4] PG_DIR_IN**: 通用端口方向切换（输入/输出）
  - 位4: PG0方向 (0=输出, 1=输入)
  - 位5: PG1方向 (0=输出, 1=输入)
  - 位6: PG2方向 (0=输出, 1=输入)
  - 位7: PG3方向 (0=输出, 1=输入)
- **位[3:0] PG_PU**: 在通用端口激活保护上拉电阻
  - 位0: PG0上拉 (0=禁用, 1=激活)
  - 位1: PG1上拉 (0=禁用, 1=激活)
  - 位2: PG2上拉 (0=禁用, 1=激活)
  - 位3: PG3上拉 (0=禁用, 1=激活)

**当前配置**: 0x00 = 0b00000000
- 所有GPIO端口为输出模式，上拉禁用

---

### 寄存器 34 (0x47) - 带隙与自动启动配置
- **位[7] INT_TRIG_BG**: 读取结束触发带隙
  - 0: 禁用
  - 1: 启用
- **位[6] DSP_TRIG_BG**: 带隙刷新由DSP位设置触发
  - 0: 禁用
  - 1: 启用
- **位[5] BG_PERM**: 激活带隙永久启用
  - 0: 带隙脉冲模式
  - 1: 带隙永久启用
  - **注意**: 当BG_PERM = 1时，电流消耗增加约20 μA
- **位[4] AUTOSTART**: 在上电后触发CDC
  - 0: 禁用
  - 1: 启用（用于独立操作，在上电后触发CDC）
- **位[3:0]**: ams内部位（必须为7）

**当前配置**: 0x47 = 0b01000111
- INT_TRIG_BG = 0 (禁用)
- DSP_TRIG_BG = 1 (启用)
- BG_PERM = 0 (脉冲模式)
- AUTOSTART = 0 (禁用)
- 位[3:0] = 7 (内部位)

---

### 寄存器 35 (0x40) - 增益缩放因子
- **位[7:0] CDC_GAIN_CORR[7:0]**: 增益校正因子（固件定义配置，8位定点数的0-7位）
  - **公式**: 增益 = 1 + n/256
  - 0x00: 增益 = 1.0
  - 0x40: 增益 = 1.25（推荐）
  - 0x80: 增益 = 1.5
  - 0xFF: 增益 ≈ 1.996

**当前配置**: 0x40 = 1.25（推荐值）

**常用配置选项**:
| 十六进制值 | 十进制值 | 增益倍数 | 说明 |
|-----------|----------|----------|------|
| 0x00 | 0 | 1.00 | 无增益校正 |
| 0x20 | 32 | 1.125 | 12.5%增益 |
| 0x40 | 64 | 1.25 | 25%增益（当前配置，推荐） |
| 0x60 | 96 | 1.375 | 37.5%增益 |
| 0x80 | 128 | 1.50 | 50%增益 |
| 0xA0 | 160 | 1.625 | 62.5%增益 |
| 0xC0 | 192 | 1.75 | 75%增益 |
| 0xFF | 255 | 1.996 | 最大增益 |

---

### 寄存器 36 (0x00) - 未使用
- **位[7:0]**: 未使用

**当前配置**: 0x00

---

### 寄存器 37 (0x00) - 未使用
- **位[7:0]**: 未使用

**当前配置**: 0x00

---

### 寄存器 38 (0x00) - 带隙时间配置
- **位[7:0] BG_TIME**: 带隙时间（固件定义）
  - 0: 推荐值

**当前配置**: 0x00 = 0（推荐值）

---

### 寄存器 39 (0x71) - 脉冲选择配置
- **位[7:4] PULSE_SEL1**: 为脉冲接口1选择源（固件定义）
  - 0-5: Res0到Res5 (C0..5 / Cref @PCap04_standard)
  - 6: Res6 (PT1/Ref @PCap04_standard)
  - 7: Res7 (Alu/Ref @PCap04_standard)
- **位[3:0] PULSE_SEL0**: 为脉冲接口0选择源（固件定义）
  - 0-5: Res0到Res5 (C0..5 / Cref @PCap04_standard)
  - 6: Res6 (PT1/Ref @PCap04_standard)
  - 7: Res7 (Alu/Ref @PCap04_standard)

**当前配置**: 0x71 = 0b01110001
- PULSE_SEL1 = 7 (Res7)
- PULSE_SEL0 = 1 (Res1)

---

### 固件和DSP相关（40-63）

### 寄存器 40 (0x00) - 电容感测选择

- **位[7:0] C_SENSE_SEL**: 电容比率选择（仅PCap04_linearize固件）
  - 0-5: C0到C5 / Cref（用于线性化的电容比率选择）
  - **说明**: 固件定义，仅在PCap04_linearize固件中使用

**当前配置**: 0x00

---

### 寄存器 41 (0x00) - 电阻感测选择
- **位[7:0] R_SENSE_SEL**: 电阻比率选择（仅PCap04_linearize固件）
  - 用于温度确定的电阻比率选择
  - **说明**: 固件定义，仅在PCap04_linearize固件中使用

**当前配置**: 0x00

---

### 寄存器 42 (0x08) - 固件配置与报警选择
- **位[7]**: 未使用
- **位[6] ALARM1_SELECT**: 报警1选择（仅PCap04_linearize固件）
  - 极性选择: 0 = Z, 1 = Theta
  - 在PG1选择报警信号源（高电平有效）
- **位[5]**: 未使用
- **位[4] ALARM0_SELECT**: 报警0选择（仅PCap04_linearize固件）
  - 极性选择: 0 = Z, 1 = Theta
  - 在PG0选择报警信号源（高电平有效）
- **位[3] EN_ASYNC_READ**: 启用异步读取
  - 0: 禁用
  - 1: 激活（结果寄存器Res0到Res7中的值仅在读取先前值后才更新）
- **位[2] HS_MODE_SEL**: ams内部位（必须为0）
- **位[1] R_MEDIAN_EN**: 启用R的中值滤波器（仅PCap04_linearize固件）
  - 在线性化固件中启用ri的中值滤波器
- **位[0] C_MEDIAN_EN**: 启用C的中值滤波器（仅PCap04_linearize固件）
  - 在线性化固件中启用ci的中值滤波器

**当前配置**: 0x08 = 0b00001000
- EN_ASYNC_READ = 1 (激活)

---

### 寄存器 43-46 (0x00, 0x00, 0x00, 0x00) - 保留寄存器
- **说明**: 这些寄存器保留供将来使用或为ams内部使用

**当前配置**: 全部为0x00

---

### 寄存器 47 (0x01) - 运行位配置
- **位[7:1]**: 未使用
- **位[0] RUNBIT**: 前端和DSP的开关
  - 0: 关闭 = 芯片系统空闲并受保护
  - 1: 开启 = 保护被移除，系统可以运行
  - **重要**: 在编程和任何寄存器修改期间应设置为"关闭"，以保护芯片免受任何不期望/未指定状态的影响

**当前配置**: 0x01 = 0b00000001
- RUNBIT = 1 (系统运行)

**注意**: 在修改寄存器配置之前，必须先将RUNBIT设置为0。

---

### 寄存器 48 (0x00) - 内存锁配置
- **位[7:4]**: 未使用
- **位[3:0] MEM_LOCK**: 数据安全功能，保护NVRAM的部分区域免于通过SIF读取和写入
  - 'bxxx1: NVRAM范围 0 到 703
  - 'bxx1x: NVRAM范围 704 到 831
  - 'bx1xx: NVRAM范围 832 到 959
  - 'b1xxx: NVRAM范围 960 到 1007 以及 1022 到 1023

**当前配置**: 0x00 = 0b00000000
- 内存锁未启用

---

### 寄存器 49 (0x00) - 序列号低字节
- **位[7:0] SERIAL_NUMBER[7:0]**: 序列号低字节（供客户自由使用）
  - **注意**: 只有当字节为零时才能写入。之后只能通过完全擦除来清除

**当前配置**: 0x00

---

### 寄存器 50 (0x00) - 序列号高字节
- **位[7:0] SERIAL_NUMBER[15:8]**: 序列号高字节（供客户自由使用）
  - **注意**: 只有当字节为零时才能写入。之后只能通过完全擦除来清除

**当前配置**: 0x00

---

### 寄存器 51-53 (0x00, 0x00, 0x00) - ams内部寄存器
- **说明**: ams内部寄存器，必须设置为0x00

**当前配置**: 全部为0x00

---

### 寄存器 54 (0x00) - 内存控制
- **位[7:0] MEM_CTRL**: 内存控制
  - 0x2D: NVRAM存储启用（将配置存储到NVRAM）
  - 0x59: NVRAM召回启用（从NVRAM重新加载配置）
  - 0xB8: NVRAM擦除（擦除NVRAM）
  - **注意**: 寄存器在SIF活动后自动重置

**当前配置**: 0x00

**使用说明**:
- 存储配置: 写入0x2D将当前寄存器配置存储到NVRAM
- 召回配置: 写入0x59从NVRAM重新加载配置
- 擦除NVRAM: 写入0xB8擦除NVRAM

---

### 寄存器 55-61 (0x00, ..., 0x00) - ams内部寄存器
- **说明**: ams内部寄存器，必须设置为0x00

**当前配置**: 全部为0x00

---

### 寄存器 62 (0x00) - 电荷泵配置低字节
- **位[7:0] CHARGE_PUMP[7:0]**: NVRAM电荷泵调整的低字节
  - **重要**: 这是设备特定的设置，不允许更改
  - **警告**: 更改此寄存器可能导致数据保留时间和耐久性周期不再得到保证

**当前配置**: 0x00（设备特定值，不应修改）

---

### 寄存器 63 (0x00) - 电荷泵配置高字节
- **位[7:0] CHARGE_PUMP[15:8]**: NVRAM电荷泵调整的高字节
  - **重要**: 这是设备特定的设置，不允许更改
  - **警告**: 更改此寄存器可能导致数据保留时间和耐久性周期不再得到保证

**当前配置**: 0x00（设备特定值，不应修改）

**重要提示**: 
- 我们仅在客户不更改寄存器62和63的情况下保证数据保留和耐久性数据
- 此外，必须严格按照NVRAM和ROM部分中描述的ERASE NVRAM程序操作
- 否则，我们不再保证数据保留时间和耐久性周期

---

## 寄存器配置总结

### 关键寄存器配置值

| 寄存器 | 地址 | 配置值 | 功能说明 |
|--------|------|--------|----------|
| Reg 0 | 0x00 | 0x1D | I²C地址 + 200kHz低频时钟 |
| Reg 2 | 0x02 | 0x58 | 放电电阻30kΩ，内部使能 |
| Reg 4 | 0x04 | 0x10 | 外部参考，单端接地测量 |
| Reg 6 | 0x06 | 0x3F | 启用PC0~PC5所有端口 |
| Reg 7-8 | 0x07-08 | 0x0020 | 32次采样平均 |
| Reg 9-11 | 0x09-0B | 0x0007D0 | 转换时间2000 (20ms @200kHz) |
| Reg 13 | 0x0D | 0x08 | 定时器触发模式 |
| Reg 17 | 0x11 | 0x24 | 内部参考电容约4-5pF |
| Reg 22 | 0x16 | 0x50 | RDC CDC异步触发 |
| Reg 27 | 0x1B | 0x08 | DSP慢速模式 |
| Reg 28 | 0x1C | 0x5A | 看门狗禁用 |
| Reg 34 | 0x22 | 0x47 | DSP触发带隙，内部位=7 |
| Reg 35 | 0x23 | 0x40 | 增益校正1.25 |
| Reg 39 | 0x27 | 0x71 | 脉冲选择配置 |
| Reg 42 | 0x2A | 0x08 | 异步读取使能 |
| Reg 47 | 0x2F | 0x01 | RUNBIT = 1（系统运行） |

### 寄存器修改流程

1. **修改寄存器前的步骤**:
   - 将寄存器47 (RUNBIT) 设置为 0
   - 修改所需的配置寄存器
   - 将寄存器47 (RUNBIT) 设置回 1

2. **保存配置到NVRAM**:
   - 将寄存器54 (MEM_CTRL) 写入 0x2D
   - 等待SIF活动完成（寄存器自动重置）

3. **从NVRAM召回配置**:
   - 将寄存器54 (MEM_CTRL) 写入 0x59
   - 等待SIF活动完成

### 注意事项

1. **不可修改的寄存器**:
   - 寄存器51-53: ams内部寄存器，必须为0x00
   - 寄存器55-61: ams内部寄存器，必须为0x00
   - 寄存器62-63: 电荷泵配置，设备特定，不允许更改

2. **必须设置的寄存器**:
   - 寄存器24-26: TDC配置，必须按照数据手册设置
   - 寄存器34位[3:0]: ams内部位，必须为7

3. **配置依赖关系**:
   - 使用外部放电电阻时，需要设置寄存器3的AUX_PD_DIS = 1
   - 如果激活C_PORT_PAT，则C_AVRG + C_FAKE应为偶数
   - 当C_FLOATING==0时，必须避免使用C_COMP_EXT

4. **性能优化建议**:
   - 增加C_AVRG可以提高测量精度，但会降低速度
   - 使用内部参考电容可以减少外部元件
   - 合理设置转换时间可以平衡速度和精度

---

## 相关函数

- `PCap04_Init()`: 基本初始化（使用PCAP04_Config）
- `PCap04_Init_Tow()`: 完整初始化（包含固件写入）
- `PCAP04_Read_CDC_Result_data()`: 读取CDC测量结果
- `integrated_data()`: 将原始数据转换为实际电容值

---

## 参考资料

- PCAP04 数据手册 (pcap04-ds000574-2-00)
- 固件版本: 1024字节（PCAP04_Firmware数组）
- ams官方文档

**文档版本**: 2.0
**最后更新**: 2025
**基于数据手册**: v1-03, 2018-Apr-04

---

## 附录：寄存器快速配置参考表

### A. 时钟配置快速参考

#### 寄存器0 - OLF时钟频率选择
```
0x1C = 10 kHz   (低功耗模式)
0x1D = 50 kHz   (标准模式)
0x1E = 100 kHz  (快速模式)
0x1F = 200 kHz  (高速模式，推荐)
```

### B. 端口配置快速参考

#### 寄存器6 - 通道使能组合
```
0x01 = 1通道 (PC0)
0x03 = 2通道 (PC0~1)
0x07 = 3通道 (PC0~2)
0x0F = 4通道 (PC0~3)
0x1F = 5通道 (PC0~4)
0x3F = 6通道 (PC0~5，全部启用)
```

#### 寄存器2 - 放电电阻选择
```
0x08 = 180kΩ (高阻，适合小电容)
0x38 = 30kΩ  (中阻，通用推荐)
0x78 = 10kΩ  (低阻，适合大电容)
```

### C. 测量模式快速参考

#### 寄存器4 - 电容测量模式
```
0x00 = 外部参考，单端接地
0x01 = 外部参考，单端浮动
0x02 = 外部参考，差分接地
0x03 = 外部参考，差分浮动
0x80 = 内部参考，单端接地
```

#### 寄存器13 - CDC触发模式
```
0x00 = 连续测量模式
0x04 = 读取触发模式
0x08 = 定时器触发模式（推荐）
0x14 = 硬件引脚触发模式
0x18 = 操作码触发模式
```

### D. 采样配置快速参考

#### 寄存器7-8 - 采样平均次数（常用值）
```
0x0001 = 1次   (最快，无平均)
0x0004 = 4次   (快速)
0x0010 = 16次  (标准)
0x0020 = 32次  (当前配置)
0x0040 = 64次  (高精度)
0x0100 = 256次 (最高精度)
```

#### 寄存器9-11 - 转换周期（@200kHz OLF）
```
0x0003E8 = 1000  → 10ms
0x0007D0 = 2000  → 20ms (当前配置)
0x000FA0 = 4000  → 40ms
0x001388 = 5000  → 50ms
0x002710 = 10000 → 100ms
```

### E. RDC配置快速参考

#### 寄存器22 - RDC触发与平均
```
0x00 = RDC禁用
0x50 = CDC异步，不平均（当前配置）
0x54 = CDC异步，4次平均
0x58 = CDC异步，8次平均
0x5C = CDC异步，16次平均
```

#### 寄存器23 - RDC端口使能
```
0x00 = 全部禁用
0x10 = 启用PTOREF
0x20 = 启用PT1
0x30 = 启用PT1和PTOREF（当前配置）
0x50 = 启用PTOREF和内部铝传感器
0x60 = 启用PT1和内部铝传感器
```

### F. 系统控制快速参考

#### 寄存器47 - 系统运行控制
```
0x00 = 系统停止（修改配置前必须设置）
0x01 = 系统运行（正常工作模式）
```

#### 寄存器28 - 看门狗控制
```
0x00 = 看门狗启用（推荐）
0x5A = 看门狗禁用（当前配置）
```

#### 寄存器54 - NVRAM操作
```
0x00 = 正常模式
0x2D = 保存配置到NVRAM
0x59 = 从NVRAM加载配置
0xB8 = 擦除NVRAM
```

TEST指令来确认系统是否正常工作,具体参考手册如下发送0x7E并读取PCAP04的回复信息，0x11表示系统工作正常，否则就表示系统有异常。

串行接口最易通过执行测试读取进行测试:
向SIF写入操作码0x7E并读取一个字节。将该字节与以下模式进行比较:
0x11:预期值，读取周期执行正确
0x88:失败:存在大端/小端序转换
0xEE:失败:在读取周期中所有位被反相
0x77:失败:位被反向且字节序为小端序



### G. 完整配置示例

#### 示例1：单通道高速测量配置
```c
unsigned char Config_SingleChannel_Fast[] = {
    0x1F,  // Reg0:  200kHz OLF
    0x00,  // Reg1:  OX禁用
    0x38,  // Reg2:  30kΩ放电电阻
    0x10,  // Reg3:  180kΩ充电电阻
    0x00,  // Reg4:  外部参考，单端接地
    0x00,  // Reg5:  默认
    0x01,  // Reg6:  仅启用PC0
    0x04, 0x00,  // Reg7-8:  4次平均
    0xE8, 0x03, 0x00,  // Reg9-11: 10ms转换周期
    // ... 其余配置
};
```

#### 示例2：六通道标准测量配置（当前配置）
```c
unsigned char Config_SixChannel_Standard[] = {
    0x1F,  // Reg0:  200kHz OLF
    0x00,  // Reg1:  OX禁用
    0x58,  // Reg2:  30kΩ放电电阻
    0x10,  // Reg3:  180kΩ充电电阻
    0x10,  // Reg4:  外部参考，单端接地
    0x00,  // Reg5:  默认
    0x3F,  // Reg6:  启用PC0~5全部端口
    0x20, 0x00,  // Reg7-8:  32次平均
    0xD0, 0x07, 0x00,  // Reg9-11: 20ms转换周期
    // ... 其余配置
};
```

#### 示例3：内部参考高精度配置
```c
unsigned char Config_Internal_HighPrecision[] = {
    0x1F,  // Reg0:  200kHz OLF
    0x00,  // Reg1:  OX禁用
    0x58,  // Reg2:  30kΩ放电电阻
    0x10,  // Reg3:  180kΩ充电电阻
    0x90,  // Reg4:  内部参考+补偿，单端接地
    0x00,  // Reg5:  默认
    0x3F,  // Reg6:  启用PC0~5
    0x00, 0x01,  // Reg7-8:  256次平均
    0x10, 0x27, 0x00,  // Reg9-11: 100ms转换周期
    // ... 其余配置
};
```

### H. 配置修改标准流程

#### 流程1：修改配置寄存器
```c
// 1. 停止系统
PCAP04_Write_Register(47, 0x00);

// 2. 修改配置（例如：改变触发模式）
PCAP04_Write_Register(13, 0x04);  // 改为读取触发

// 3. 启动系统
PCAP04_Write_Register(47, 0x01);
```

#### 流程2：保存配置到NVRAM
```c
// 1. 停止系统
PCAP04_Write_Register(47, 0x00);

// 2. 修改所需配置
PCAP04_Write_Registers(0, PCAP04_Config, 52);

// 3. 保存到NVRAM
PCAP04_Write_Register(54, 0x2D);
HAL_Delay(20);  // 等待保存完成

// 4. 启动系统
PCAP04_Write_Register(47, 0x01);
```

#### 流程3：从NVRAM恢复配置
```c
// 1. 停止系统
PCAP04_Write_Register(47, 0x00);

// 2. 从NVRAM加载
PCAP04_Write_Register(54, 0x59);
HAL_Delay(20);  // 等待加载完成

// 3. 启动系统
PCAP04_Write_Register(47, 0x01);
```

### I. 常见应用配置建议

#### 应用1：触摸按键检测
- **通道数**: 4-12通道（0x0F或自定义组合）
- **触发模式**: 定时器触发（0x08）
- **采样平均**: 16-32次（0x0010-0x0020）
- **转换周期**: 10-20ms（0x03E8-0x07D0）
- **放电电阻**: 30kΩ（0x38）

#### 应用2：接近检测
- **通道数**: 1-4通道（0x01-0x0F）
- **触发模式**: 连续模式（0x00）
- **采样平均**: 64-128次（0x0040-0x0080）
- **转换周期**: 50-100ms（0x1388-0x2710）
- **放电电阻**: 30kΩ（0x38）

#### 应用3：液位检测
- **通道数**: 1-2通道（0x01-0x03）
- **触发模式**: 定时器触发（0x08）
- **采样平均**: 128-256次（0x0080-0x0100）
- **转换周期**: 100-200ms（0x2710-0x4E20）
- **放电电阻**: 180kΩ（0x08）

#### 应用4：湿度传感器
- **通道数**: 1-2通道（0x01-0x03）
- **测量模式**: 差分浮动（0x03）
- **采样平均**: 256次以上（0x0100+）
- **转换周期**: 200ms以上（0x4E20+）
- **放电电阻**: 180kΩ（0x08）

---

**配置提示**:
1. 修改配置前务必将RUNBIT（寄存器47）设为0
2. 采样次数越多精度越高，但速度越慢
3. 放电电阻根据电容大小选择：小电容用高阻，大电容用低阻
4. 定时器触发模式适合大多数应用场景
5. 需要长期保存配置时使用NVRAM存储功能
